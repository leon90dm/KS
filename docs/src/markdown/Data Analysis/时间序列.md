# 时间序列

## 基本定义

$\rho_l$
:   $\frac{Cov\left(r_{t}, r_{t-l}\right)}{Var\left(r_{t}\right)}$   间隔 $l$ 的自相关系数。

## 平稳性

=== "严平稳"
    ($r_1,\dots,r_t$) 的联合分布在时间的平移变换下 **保持不变**。

=== "弱平稳"
    1. 一阶矩为常数，$E(r_t) = u$ 均值为常数。
    2. 二阶矩收敛，$E(r_t^2) < \infty$.
    3. $Cov(r_t, r_{t-l}) = \gamma_l$ 结果只依赖于 $l$ ，而不依赖于 $t$

## 纯随机检验

纯随机检验也称为 **白噪声检验** 

=== "Q统计量"
    todo
=== "LB统计量"
    todo

## 预测方法

有时候最简单的预测方法可能会是最好的预测方法，但是在很多情况下，这些方法只是作为基准方法而不是被直接运用。也就是说，我们提出的任何预测方法都会和这些简单方法比较，以保证其预测结果优于这些简单方法，否则，新的方法就不值得考虑。

=== "均值法"
    $\hat{y}_{T+h|T} = E(y_i)$ 其中 $h$ 为预测期数。

    ```R
        meanf(ts, h=11)
    ```

=== "Naive"
    所有预测值设置为最后一次观测值：$\hat{y}_{T+h|T} = y_T$。 这种方法看似简单，但当数据服从 *随机游走* 过程时，Naive预测是最优的。因此也被称为“随机游走预测”。

    ```R
        naive(ts, h=11)
    ```

=== "季节性Naive"
    将预测值设置为去年同一个季节前一期的观测值： $\hat{y}_{T+h|T} = y_{T+h-km}$， 其中 $m$ 为周期长度，比如：对于月度数据，未来所有二月的预测值都等于前一年二月的观测值。

    ```R
        snaive(ts, h=11)
    ```

=== "漂移法"
     允许预测值随着时间的推移增大或减小，并且我们假定单位时间改变量（称作 “漂移”）等于历史数据的平均改变量，$\hat{y}_{T+h|T} = y_T + h\frac{y_T - y_1}{T - 1}$ 。

    ```R
        rwf(ts, h=11)
    ```

## 数据变换

=== "日历调整"
    1. 将月总和调整为日均（每个月天数不一样）
=== "人口调整"
    1. 任何受人口数量影响的数据都可以调整为人均数据，换句话说，考虑每人（或每千人，或每百万人）而非所有人。
=== "通胀调整"
    通胀调整需要用到价格指数 $z_t$ 
=== "数学变换"
    1. log变换 $w_t = log(y_t)$
    2. 幂变换, "Box-cox"变换[^boxcox]

## 残差

一个好的预测方法产生的残差具有以下特性：

=== "不相关"
    如果残差之间存在相关性，那么残差中包含的数据信息应该被用于计算预测值。[检验方法](#评估方法)
=== "均值为零"
    如果残差的均值不为零，那么说明预测是有偏差的。[检验方法](#评估方法)

除了上述的基本性质外，残差最好也满足下列两个性质，因为它们能够让预测区间的计算变得容易。（但不是必须满足）：

===! "常数方差"
     残差的方差是常数
=== "正态分布"
     残差满足正态分布


## 回归模型

### 评估方法

=== "残差自相关函数（ACF）图"
    检验残差自相关的效果较好的检验方法是 Breusch-Godfrey 检验，也被称为 LM （拉格朗日乘数）检验。假如p值小于一个特定值（例如0.05），则表明残差中存在显著的自相关性。Breusch-Godfrey 检验类似于 Ljung-Box 检验，但它是专门用于回归模型的残差检验。

=== "残差直方图"
    todo

=== "预测变量与残差的关图"
    我们期望残差是随机分布的并且不显示任何规律，一个简单快捷的检验方法是查看每个预测变量与残差的散点图。如果这些散点图表现出明显的规律，则该关系可能是非线性的，并且需要相应地修改模型。

### 伪回归

不平稳的时间序列会导致伪回归。伪回归的特点是高$R^2$值和高残差自相关共存。

## 高效的预测变量

### 预测变量的构造

=== "趋势"
    很多的时间序列存在趋势。当存在简单的线性趋势时，可以直接加入 _时间 $t$ _ 变量。$y_{t}=\beta_{0}+\beta_{1} t+\varepsilon_{t}$

=== "虚变量"
     one-hot

=== "干预变量"
    建模时，我们通常需要考虑可能对被预测变量的产生影响的干预因素。例如竞争对手的活动、广告支出、工业行动等等都会对被预测变量产生影响。当干预因素的影响仅持续一个时期时，我们可以使用“尖峰”变量来描述。尖峰变量的处理方法和处理离群点非常相似，也是构造一个虚拟变量，在干预因素作用期间取值1，在其他地方取0。干预因素的影响还可能是长期或永久的。如果干预因素导致水平偏移（即序列的值从干预时间点之后突然且永久地改变），那么我们使用“阶梯”变量。阶梯变量在干预产生之前取值为0，从干预产生之后取值为1。干预因素的另一种长远影响是斜率的变化。此时需采取分段处理，在干预因素产生影响前后斜率是不同的，因此模型是非线性的。

=== "交易日"
    可以分别构造周一到周日各个类别的天数。 $x_1 = \text{当月中周一的天数}, \dots, x_7 = \text{当月中周日的天数}$

=== "分布滞后"
    todo

=== "傅里叶级数"
    todo

### 预测变量的筛选

=== "不应作为变量筛选的方法"
    1. ~~直接查看变量和目标值的关系图（散点图并不总能正确的反映两个变量之间的关系。）~~
    2. ~~进行多元线性回归，并删除所有 p值大于0.05的所有变量。统计显著性并不总能表示预测变量的预测价值。因为当两个或者多个预测变量相互关联时，p值可能会是错误的结果。~~
    3. ~~$R^2$ 会受到“自由度”的影响。在模型中增加任意一个变量（即便该变量与被预测变量无关）都会导致 $R^2$ 值增大。~~
   
=== "交叉检验CV"
     content  

=== "TODO"
    TODO




[^boxcox]: $$w_{t}=\left\{\begin{array}{ll}
            \log \left(y_{t}\right) & \text { if } \lambda=0 \\
            \left(y_{t}^{\lambda}-1\right) / \lambda & \text { otherwise }
            \end{array}\right.$$